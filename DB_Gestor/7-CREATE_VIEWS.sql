-- Vista para los Usuarios
CREATE OR REPLACE VIEW GPYV_001_USUARIO AS
SELECT A041CODIGO, NVL(A052NOMBRE, ' ') A052NOMBRE, A052APELLIDO, A052TIPDOCMNT, A015DESCRPCNTIPDOCMNT, A052NUMRDOCMNT, A052DIGTCHQU, A001CODIGO, A001NOMBRE, A041USERNAME, A041ESTADOREGISTRO, A052CODIGO, A041IDCLASUSR, A041PRIMRINGRS, A041CLAVE
FROM GPYT_T041_USUARIO, GPYT_T015_TIPO_DOCUMENTO, GPYT_T052_PERSONA
LEFT JOIN GPYT_T001_ENTIDAD ON A052IDENTIDAD = A001CODIGO 
WHERE A041IDPERSONA = A052CODIGO  
AND A015CODIGO = A052TIPDOCMNT;
 
-- Vista para el Representante Legal
CREATE OR REPLACE VIEW GPYV_002_REPLEGAL AS
SELECT A053CODIGO, A053IDPERSONAJURD, A053IDREPRESENTANTE, A053TIPOREPRESENTANTE, A102VALOR TIPOREPLEGAL, A052NOMBRE, A052APELLIDO, 
A052TIPDOCMNT, A052NUMRDOCMNT, A015DESCRPCNTIPDOCMNT, A052LGREXPCNDOCMNT, A052DIRCCNCORRSPNDNC, A052LOCLZCN, A020CODPAIS, A020NOMPAIS, 
A020CODDEPARTAMENTO, A020NOMDEPARTAMENTO, A020CODMUNICIPIO, A020NOMMUNICIPIO, A052TELEFONO, A052CELULAR, A052CORRELCTRNC, 
A052CODIGO, A053IDARCHIVO, A026DESCRPCNARCHIV, A026NOMARCHIVO, A026HASHARCHIVO, A053ESTADOREGISTRO
FROM GPYT_T052_PERSONA, GPYT_T015_TIPO_DOCUMENTO, PART_T102_LISTA, GPYT_T020_DIVIPOLA, GPYT_T053_REPLEGAL
LEFT JOIN GPYT_T026_ARCHIVO ON A053IDARCHIVO = A026CODIGO
WHERE A053IDREPRESENTANTE = A052CODIGO
AND A015CODIGO = A052TIPDOCMNT 
AND A102CODIGO = A053TIPOREPRESENTANTE
AND A020CODIGO = A052LOCLZCN;
 
-- Vista para los datos basicos del proyecto
  CREATE OR REPLACE FORCE VIEW "GESTOR"."GPYV_003_DATOSBASICOS" ("A002CODIGO", "A002NOMBRPROYCT", "A002DESCRPCINPROYCT", "A002TIPPROYCT", "TIPPROYCT", "A002DURCNPREVST", "A002PROYTASCD", "NOMBRPROYCTASCD", "A002UBCCN", "UBCCN", "A020CODDEPARTAMENTO", "A020NOMDEPARTAMENTO", "A020NOMMUNICIPIO", "A002LOCLZCN", "CODDIVIPOLA", "A002IDUSR", "A002SOCEXTRNJR", "A002COSTSESTMDTOTL", "A002COSTSESTMDFORMLCN", "A002COSTTONLDRDCR", "A002TRM", "A002BUSQUDFINNCCN", "A002PLANPRGRMNACNL", "A002OBJTVGENRL", "A002POTNCLESTMDREDCCN", "A002NOMBRPROYCTINGLS", "A002TECNLGCONTMPLD", "A002IDESCALA", "ESCALA", "A002IDALCANCE", "ALCANCE", "A002IDMETDLGMDL", "A028DESCMETDLGMDL", "A002NROCPAS", "A002PROCSVALDCNEC", "A002IDESTDPROCSVALDCN", "A002IDPROYCTMDL", "A002VIDAUTL", "A002FECHINICIO", "A002FECHFIN", "A002APLICMERCDVOLNTR", "A002ESTADOPROYECTO") AS 
  SELECT P.A002CODIGO, P.A002NOMBRPROYCT, P.A002DESCRPCINPROYCT, P.A002TIPPROYCT, L1.A102VALOR TIPPROYCT, P.A002DURCNPREVST, P.A002PROYTASCD, A.A002NOMBRPROYCT NOMBRPROYCTASCD, 
P.A002UBCCN, L2.A102VALOR UBCCN, A020CODDEPARTAMENTO, A020NOMDEPARTAMENTO, A020NOMMUNICIPIO, P.A002LOCLZCN, SUBSTR(REPLACE(D.A020DIVIPOLA,'-',''),3) CODDIVIPOLA, P.A002IDUSR, P.A002SOCEXTRNJR, 
P.A002COSTSESTMDTOTL, P.A002COSTSESTMDFORMLCN, P.A002COSTTONLDRDCR, P.A002TRM, P.A002BUSQUDFINNCCN, P.A002PLANPRGRMNACNL, P.A002OBJTVGENRL, P.A002POTNCLESTMDREDCCN, 
P.A002NOMBRPROYCTINGLS, P.A002TECNLGCONTMPLD, P.A002IDESCALA, L10.A102VALOR ESCALA, P.A002IDALCANCE, L3.A102VALOR ALCANCE, P.A002IDMETDLGMDL, M.A028DESCMETDLGMDL, 
P.A002NROCPAS, P.A002PROCSVALDCNEC, P.A002IDESTDPROCSVALDCN, P.A002IDPROYCTMDL, P.A002VIDAUTL, P.A002FECHINICIO, P.A002FECHFIN, P.A002APLICMERCDVOLNTR, P.A002ESTADOPROYECTO
FROM
PART_T102_LISTA L1, -- Tipo proyecto
PART_T102_LISTA L2, -- Ubicacion
PART_T102_LISTA L3, -- Alcance
GPYT_T020_DIVIPOLA D, GPYT_T002_PROYECTO P
LEFT JOIN GPYT_T002_PROYECTO A ON A.A002CODIGO = P.A002PROYTASCD  -- proyecto asociado
LEFT JOIN GPYT_T028_METODOLOGIA_MDL M ON M.A028CODIGO = P.A002IDMETDLGMDL
LEFT JOIN PART_T102_LISTA L4 ON L4.A102CODIGO = P.A002IDESTDPROCSVALDCN -- Estado del proceso de validacion
LEFT JOIN PART_T102_LISTA L5 ON L5.A102CODIGO = P.A002IDPROYCTMDL -- Tipo de proyecto MDL
LEFT JOIN PART_T102_LISTA L6 ON L6.A102CODIGO = P.A002IDTIPPERDACRDTCN -- Tipo de periodo de acreditaci√≤n
LEFT JOIN PART_T102_LISTA L7 ON L7.A102CODIGO = P.A002IDESTNDRMERCDVOLNTR -- Estandar del Mercado Voluntario
LEFT JOIN PART_T102_LISTA L8 ON L8.A102CODIGO = P.A002ESTADOPROYECTO -- Estado del proyecto
--LEFT JOIN GPYT_T020_DIVIPOLA L9 ON L9.A020CODIGO = P.A002LOCLZCN -- Localizacion
LEFT JOIN PART_T102_LISTA L10 ON L10.A102CODIGO = P.A002IDESCALA -- Escala
WHERE P.A002LOCLZCN = D.A020CODIGO -- Divipola
AND L1.A102CODIGO = P.A002TIPPROYCT
AND L2.A102CODIGO = P.A002UBCCN 
AND L3.A102CODIGO = P.A002IDALCANCE;    
 
-- Vista para los contactos 
CREATE OR REPLACE VIEW GPYV_004_CONTACTOS AS
SELECT A054CODIGO, A054IDPERSONA, A052NOMBRE, A052APELLIDO, A052TIPDOCMNT, A052NUMRDOCMNT, A015DESCRPCNTIPDOCMNT, 
A052DIRCCNCORRSPNDNC, A052LOCLZCN, A020CODPAIS, A020NOMPAIS, A020CODDEPARTAMENTO, A020NOMDEPARTAMENTO, A020CODMUNICIPIO, A020NOMMUNICIPIO, 
A052TELEFONO, A052CELULAR, A052CORRELCTRNC, A052CODIGO, A054ESTADOREGISTRO
FROM GPYT_T052_PERSONA P, GPYT_T054_CONTACTO, GPYT_T020_DIVIPOLA, GPYT_T015_TIPO_DOCUMENTO
WHERE A052LOCLZCN = A020CODIGO
AND A054IDCONTACTO = A052CODIGO
AND A015CODIGO = A052TIPDOCMNT;
 
-- Vista para los publicadores 
CREATE OR REPLACE VIEW GPYV_005_PUBLICADORES AS
SELECT A055CODIGO, A052NOMBRE, A052APELLIDO, A052DIRCCNCORRSPNDNC, A052LOCLZCN, A020CODPAIS, A020NOMPAIS, A020CODDEPARTAMENTO, A020NOMDEPARTAMENTO, A020CODMUNICIPIO, A020NOMMUNICIPIO
A052TELEFONO, A052CELULAR, A052CORRELCTRNC, A055IDPERSONA, A055ESTADOREGISTRO
FROM GPYT_T052_PERSONA P, GPYT_T055_PUBLICADOR, GPYT_T020_DIVIPOLA
WHERE A052LOCLZCN = A020CODIGO
AND A055IDPUBLICADOR = A052CODIGO;
 
-- Vista para la grilla de proyectos
 CREATE OR REPLACE FORCE VIEW "GESTOR"."GPYV_006_PROYECTOS" ("A001CODIGO", "A001SIGLA", "A002CODIGO", "A001NOMBRE", "TIPOPROYECTO", "A002TIPPROYCT", "A002DESCRPCINPROYCT", "ESTADOPROYECTO", "A002IDUSR", "A055IDPUBLICADOR", "A002ESTADOREGISTRO", "A002FECHACREACION") AS 
  SELECT A001CODIGO,
    A001SIGLA, 
    A002CODIGO,
    A001NOMBRE,
    L1.A102VALORCORTO TIPOPROYECTO,
    A002TIPPROYCT,
    A002DESCRPCINPROYCT,
    L2.A102VALOR ESTADOPROYECTO,
    A002IDUSR,
    A002IDUSR A055IDPUBLICADOR,
    A002ESTADOREGISTRO,
    A002FECHACREACION
  FROM GPYT_T002_PROYECTO,
    PART_T102_LISTA L1,
    GPYT_T041_USUARIO,
    PART_T102_LISTA L2,
    GPYT_T052_PERSONA
  LEFT JOIN GPYT_T001_ENTIDAD
  ON A001CODIGO       = A052IDENTIDAD
  WHERE A041IDPERSONA = A052CODIGO
  AND A002IDUSR       = A041CODIGO
  AND L1.A102CODIGO   = A002TIPPROYCT -- tipo de proyecto
  AND L2.A102CODIGO   = A002ESTADOPROYECTO
  UNION
  SELECT A001CODIGO,
    A001SIGLA,
    A002CODIGO,
    A001NOMBRE,
    L1.A102VALORCORTO TIPOPROYECTO,
    A002TIPPROYCT,
    A002DESCRPCINPROYCT,
    L2.A102VALOR ESTADOPROYECTO,
    A002IDUSR,
    A055IDPUBLICADOR,
    A002ESTADOREGISTRO,
    A002FECHACREACION
  FROM GPYT_T002_PROYECTO,
    PART_T102_LISTA L1,
    GPYT_T041_USUARIO,
    PART_T102_LISTA L2,
    GPYT_T055_PUBLICADOR,
    GPYT_T052_PERSONA
  LEFT JOIN GPYT_T001_ENTIDAD
  ON A001CODIGO       = A052IDENTIDAD
  WHERE A041IDPERSONA = A052CODIGO
  AND A002IDUSR       = A041CODIGO
  AND L1.A102CODIGO   = A002TIPPROYCT -- tipo de proyecto
  AND L2.A102CODIGO   = A002ESTADOPROYECTO
  AND A041IDPERSONA   = A055IDPUBLICADOR;
 
-- Vista para la grilla de proyectos
CREATE OR REPLACE VIEW GPYV_008_PERSONAS AS
SELECT A052CODIGO, A052TIPDOCMNT, A015DESCRPCNTIPDOCMNT, A052NUMRDOCMNT, A052DIGTCHQU, A052IDTIPPERSN, A102VALOR DESCTIPPERSN, A052NOMBRE, A052APELLIDO, A052LGREXPCNDOCMNT, A052DIRCCNCORRSPNDNC, 
A052LOCLZCN, A020CODIGO, A020CODPAIS, A020NOMPAIS, A020CODDEPARTAMENTO, A020NOMDEPARTAMENTO, A020CODMUNICIPIO, A020NOMMUNICIPIO, A052TELEFONO, A052CELULAR, A052CORRELCTRNC, A052CODGCIIU, A049DESCRIPCIONCIIU,
A052IDENTIDAD, A001SIGLA, A001NOMBRE, A052ESTADOREGISTRO
FROM GPYT_T015_TIPO_DOCUMENTO, PART_T102_LISTA, GPYT_T052_PERSONA
LEFT JOIN GPYT_T001_ENTIDAD ON A052IDENTIDAD = A001CODIGO
LEFT JOIN GPYT_T049_CODIGOCIIU ON A052CODGCIIU = A049CODIGOCIIU
LEFT JOIN GPYT_T020_DIVIPOLA ON A052LOCLZCN = A020CODIGO
WHERE A052TIPDOCMNT = A015CODIGO
AND A052IDTIPPERSN = A102CODIGO;
 
-- Vista para la grilla de actividades
CREATE OR REPLACE VIEW GPYV_009_ACTIVIDADES AS
SELECT A005CODIGO, A005DESCRPCNACTVDD, A005IDTIPACTVDD, A022DESCRPCNACTVDD, A005IDSECTORIPCC, A023DESCSECTRIMPLMNTDR, A005FECHAINICIO, 
A005FECHAFINAL, A005IDSOPORTE, A026DESCRPCNARCHIV, A026NOMARCHIVO, A026HASHARCHIVO, A005IDPROYECTO, A005ESTADOREGISTRO
FROM GPYT_T005_ACTIVIDAD
LEFT JOIN GPYT_T022_TIPO_ACTIVIDAD ON A022CODIGO = A005IDTIPACTVDD
LEFT JOIN GPYT_T023_SECTOR_IMPLEMENTADOR ON A023CODIGO = A005IDSECTORIPCC
LEFT JOIN GPYT_T026_ARCHIVO ON A026CODIGO = A005IDSOPORTE;
